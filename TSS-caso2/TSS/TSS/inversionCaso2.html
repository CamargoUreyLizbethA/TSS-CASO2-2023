<!DOCTYPE html>
<html lang="es">
<head> 
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-blend-mode: multiply;
            background-image: url(https://www.umss.edu.bo/wp-content/uploads/2021/11/5650360.png),
                linear-gradient(56deg, #002a4c 76%, #e30613 100%)!important;
            margin: 0; /* Elimina el margen predeterminado del body */
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px; /* Ajusta el espacio interno según sea necesario */
            background-color: #181c29; /* Cambia el color de fondo del encabezado */
        }

        header img {
            width: 50px; /* Ajusta el tamaño del logo según sea necesario */
            margin-right: 10px; /* Ajusta el espacio a la derecha del logo según sea necesario */
        }

        header h2 {
            font-size: 24px;
            color: white;
            margin: 0; /* Elimina el margen predeterminado del h2 */
        }

        button {
            background-color: #e30613;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }

        h2 {
            font-size: 24px;
            color: white;
        }

        table {
            font-family: Arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #181c29;
            color: white;
            text-align: left;
            padding: 8px;
        }

        th {
            background-color: #181c29;
        }
    </style>
    <title>Simulación de Decisiones sobre Inversiones</title>
</head>
<body>

<header>
    <img src="imagenes/logo redondo.png" alt="Logo"> <!-- Reemplaza "ruta_del_logo.png" con la ruta real de tu logo -->
    <h2>Caso 2</h2>
    <button onclick="goBack()">Atrás</button>
</header>

<h2>Configuración de Simulación</h2>

<button onclick="setInversionInicial()">Configurar Inversión Inicial</button>
<button onclick="setFlujoNeto()">Configurar Flujo Neto del Periodo T</button>
<button onclick="addEscenarios()">Añadir Escenarios</button>
<button onclick="calcularTIR()">Calcular TIR</button>

<h2>Simulación de Decisiones sobre Inversiones</h2>

<table id="tablaSimulacion">
    <tr>
        <th>Escenario</th>
        <th>Inversión Inicial</th>
        <th>Flujo de Caja Neto del Año 1</th>
        <th>Flujo de Caja Neto del Año 2</th>
        <th>Flujo de Caja Neto del Año 3</th>
        <th>Flujo de Caja Neto del Año 4</th>
        <th>Flujo de Caja Neto del Año 5</th>
        <th>TIR</th>
        <th>APROBADO</th>
    </tr>
    
</table>

<script>
    let escenarios = [];
    let mediaInversion;
    let desviacionInversion;
    let mediaFlujo;
    let desviacionFlujo;

    function setInversionInicial() {
        mediaInversion = parseFloat(prompt("Ingrese la media de la inversión inicial:"));
        desviacionInversion = parseFloat(prompt("Ingrese la desviación estándar de la inversión inicial:"));
    }

    function setFlujoNeto() {
        mediaFlujo = parseFloat(prompt("Ingrese la media del flujo neto del periodo t:"));
        desviacionFlujo = parseFloat(prompt("Ingrese la desviación estándar del flujo neto del periodo t:"));
    }

    function addEscenarios() {
        let numEscenarios = prompt("Ingrese el número de escenarios a simular:");
        console.log("Número de Escenarios:", numEscenarios);

        for (let i = 1; i <= numEscenarios; i++) {
            let inversionInicial = generarNumeroAleatorio(mediaInversion, desviacionInversion);
            let flujoAnual1 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual2 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual3 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual4 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual5 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);

            let fila = `<tr>
                            <td>${i}</td>
                            <td>${inversionInicial}</td>
                            <td>${flujoAnual1}</td>
                            <td>${flujoAnual2}</td>
                            <td>${flujoAnual3}</td>
                            <td>${flujoAnual4}</td>
                            <td>${flujoAnual5}</td>
                            <td>Calculando...</td>
                            <td>...</td>
                        </tr>`;
            document.getElementById("tablaSimulacion").insertAdjacentHTML('beforeend', fila);
        }
    }

    function generarNumeroAleatorio(media, desviacion) {
        return (Math.random() * desviacion * 2 + media - desviacion).toFixed(2);
    }

    function calcularTIR() {
        // Recorre las filas de la tabla y calcula la TIR para cada escenario
        let filas = document.getElementById("tablaSimulacion").rows;
        for (let i = 1; i < filas.length; i++) {
            let flujos = [
                parseFloat(filas[i].cells[1].innerHTML),
                parseFloat(filas[i].cells[2].innerHTML),
                parseFloat(filas[i].cells[3].innerHTML),
                parseFloat(filas[i].cells[4].innerHTML),
                parseFloat(filas[i].cells[5].innerHTML),
            ];

            // Calcula la TIR para el escenario actual (usando el método FET)
            let tirCalculada = calcularTIRconFET(flujos);
            
            // Actualiza la celda de TIR en la tabla
            filas[i].cells[7].innerHTML = tirCalculada.toFixed(4);

            // Añade la lógica para mostrar "APROBADO" o "NO" en la columna correspondiente
            let aprobado = tirCalculada >= 0 ? "APROBADO" : "NO";
            filas[i].cells[8].innerHTML = aprobado;
        }
    }

    function calcularTIRconFET(flujos) {
        let inversionInicial = flujos[0];
        let flujosNetos = flujos.slice(1);
        let factorRecuperacion = 0;
        let acumulado = 0;

        for (let i = 0; i < flujosNetos.length; i++) {
            acumulado += flujosNetos[i];
            factorRecuperacion += acumulado / Math.pow(1 + i, 2);
        }

        return (inversionInicial / factorRecuperacion - 1) * 100;
    }

    function goBack() {
        history.back();
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-blend-mode: multiply;
            background-image: url(https://www.umss.edu.bo/wp-content/uploads/2021/11/5650360.png),
                linear-gradient(56deg, #002a4c 76%, #e30613 100%)!important;
            margin: 0; /* Elimina el margen predeterminado del body */
            text-align: center; /* Centra el contenido del body */

        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px; /* Ajusta el espacio interno según sea necesario */
            background-color: #181c29; /* Cambia el color de fondo del encabezado */
        }

        header img {
            width: 50px; /* Ajusta el tamaño del logo según sea necesario */
            margin-right: 10px; /* Ajusta el espacio a la derecha del logo según sea necesario */
        }

        header h2 {
            font-size: 24px;
            color: white;
            margin: 0; /* Elimina el margen predeterminado del h2 */
        }

        button {
            background-color: #181c29;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }

        h2 {
            font-size: 25px;
            color: #181c29;
            text-align: center; /* Centra el texto */
        }
        p {
         color: #181c29;
         text-align: justify; /* Centra el texto */
           font-size: 1.3rem;
         margin-left: 3cm;
         margin-right: 3cm;
        }

        table {
            font-family: Arial, sans-serif;
            border-collapse: collapse;
            width: 100%; /* Ajusta el ancho de la tabla según sea necesario */
            margin: 20px auto; /* Centra la tabla horizontalmente y agrega espacio arriba/abajo */
        }

        th, td {
            border: 1px solid #181c29;
            color:#181c29;
            padding: 8px;
            background-color: #f5f5f5;
        }

        th {
            background-color: #181c29;
            color:white;
        }

        /* Estilos específicos para la tabla */
        table.small-table {
            width: 40%; /* Ajusta el ancho de la tabla específica según sea necesario */
        }

        table.small-table td:nth-child(1) {
            background-color: #002a4c; /* Fondo azul para la primera columna */
            color:white;

        }

        table.small-table td:nth-child(2) {
            background-color: #1f8dd6; /* Fondo celeste para la segunda columna */
            color:white;

        }
    </style>
    <title>Simulación de Decisiones sobre Inversiones</title>
</head>
<body>
<header>
    <img src="imagenes/logo redondo.png" alt="Logo"> <!-- Reemplaza "ruta_del_logo.png" con la ruta real de tu logo -->
    <h2>Caso de Estudio 2: Decisiones sobre Inversiones</h2>
    <button onclick="goBack()">Atrás</button>
</header>
<div id="contenido-pdf">
<div>
    <!-- Botón para mostrar/ocultar la explicación de cálculos -->
<button onclick="toggleDescripcion()" style="margin-bottom: 10px; padding: 8px 16px; background-color: #002a4c; color: white; border: none; cursor: pointer;">Descripcion</button>

<!-- Área oculta para la explicación de cálculos -->
<div id="explicacion-descripcion" style="display: none; background-color: #f5f5f5; padding: 10px; border-radius: 5px;">
    <h2>Caso de Estudio 2: Decisiones sobre Inversiones</h2>
    <p>Una empresa desea entrar en un nuevo negocio cuya inversión inicial requerida y los ingresos netos anuales después de impuestos están distribuidos como sigue:</p>
    <table class="small-table">
        <tr>
            <td>Inversión inicial</td>
            <td>N(μ =100.000, σ = 5.000)</td>
        </tr>
        <tr>
            <td>Flujo neto del periodo t</td>
            <td>N(μ = 30.000, σ = 3.000)</td>
        </tr>
    </table>    
    <p>Si la administración ha establecido que un proyecto de inversión será emprendido si Prob{TIR > TREMA} ≥ 0,90, y la TREMA es de 30%, ¿debería la empresa X aceptar este nuevo proyecto de inversión? .Asuma un horizonte de planeación de 5 años y un valor de rescate al término de este tiempo de cero.</p>
</div>
    
</div>
<h2>Configuración de Simulación</h2>
<div>
<button onclick="setInversionInicial()">Configurar Inversión Inicial</button>
<button onclick="setFlujoNeto()">Configurar Flujo Neto del Periodo T</button>
<button onclick="addEscenarios()">Añadir Escenarios</button>
<button onclick="calcularTIR()">Calcular TIR</button>
<tr></tr>
<button onclick="generarPDF()" style="background-color: #a52019; color: white; border: none; padding: 8px; cursor: pointer;">Generar PDF <span>&#128462;</span></button>
<button onclick="generarExcel()" style="background-color: #008f39; color: white; border: none; padding: 8px; cursor: pointer;">Generar Excel <i class="fas fa-file-excel"></i></button>
</div>
<h2>Simulación de Decisiones sobre Inversiones</h2>
<!-- Botón para mostrar/ocultar la explicación de cálculos -->
<button onclick="toggleExplicacion()" style="margin-bottom: 10px; padding: 8px 16px; background-color: #002a4c; color: white; border: none; cursor: pointer;">Explicación de cálculos</button>

<!-- Área oculta para la explicación de cálculos -->
<div id="explicacion-calculos" style="display: none; background-color: #f5f5f5; padding: 10px; border-radius: 5px;">
    <h3>Explicación de Cálculos</h3>
    <h3 style="color: #333;">Escenario</h3>
    <p>Se refiere a una instancia específica de la simulación de decisiones sobre inversiones. Cada vez que se ejecuta la función addEscenarios(), se generan varios escenarios simulados para evaluar el rendimiento financiero del proyecto de inversión en diferentes condiciones.</p>
    <!-- Agrega más explicaciones según sea necesario -->
</div>
<!-- Área para mostrar el mensaje de factibilidad de inversión -->
<div id="mensaje-factibilidad" style="margin-top: 20px; color: white;"></div>
<!-- Área para mostrar la conclusión general -->
<div id="conclusion-general" style="margin-top: 20px; background-color: #002a4c; color: white; padding: 10px; border-radius: 5px;">
</div>

<table id="tablaSimulacion">
    <tr>
        <th>Escenario</th>
        <th>Inversión Inicial</th>
        <th>Flujo de Caja Neto del Año 1</th>
        <th>Flujo de Caja Neto del Año 2</th>
        <th>Flujo de Caja Neto del Año 3</th>
        <th>Flujo de Caja Neto del Año 4</th>
        <th>Flujo de Caja Neto del Año 5</th>
        <th>TIR</th>
        <th>APROBADO</th>
    </tr>
    
</table>
</div>
<script>
     // Función para mostrar u ocultar la explicación de cálculos
     function toggleDescripcion() {
        const descripcion = document.getElementById("explicacion-descripcion");
        descripcion.style.display = (descripcion.style.display === "none") ? "block" : "none";
    }

     // Función para mostrar u ocultar la explicación de cálculos
     function toggleExplicacion() {
        const explicacion = document.getElementById("explicacion-calculos");
        explicacion.style.display = (explicacion.style.display === "none") ? "block" : "none";
    }
    let escenarios = [];
    let mediaInversion;
    let desviacionInversion;
    let mediaFlujo;
    let desviacionFlujo;

    function setInversionInicial() {
        mediaInversion = parseFloat(prompt("Ingrese la media de la inversión inicial:"));
        desviacionInversion = parseFloat(prompt("Ingrese la desviación estándar de la inversión inicial:"));
    }

    function setFlujoNeto() {
        mediaFlujo = parseFloat(prompt("Ingrese la media del flujo neto del periodo t:"));
        desviacionFlujo = parseFloat(prompt("Ingrese la desviación estándar del flujo neto del periodo t:"));
    }

    function addEscenarios() {
        let numEscenarios = prompt("Ingrese el número de escenarios a simular:");
        console.log("Número de Escenarios:", numEscenarios);

        for (let i = 1; i <= numEscenarios; i++) {
            let inversionInicial = generarNumeroAleatorio(mediaInversion, desviacionInversion);
            let flujoAnual1 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual2 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual3 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual4 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);
            let flujoAnual5 = generarNumeroAleatorio(mediaFlujo, desviacionFlujo);

            let fila = `<tr>
                            <td>${i}</td>
                            <td>${inversionInicial}</td>
                            <td>${flujoAnual1}</td>
                            <td>${flujoAnual2}</td>
                            <td>${flujoAnual3}</td>
                            <td>${flujoAnual4}</td>
                            <td>${flujoAnual5}</td>
                            <td>Calculando...</td>
                            <td>...</td>
                        </tr>`;
            document.getElementById("tablaSimulacion").insertAdjacentHTML('beforeend', fila);
        }
    }

    function generarNumeroAleatorio(media, desviacion) {
        return (Math.random() * desviacion * 2 + media - desviacion).toFixed(2);
    }

    function calcularTIR() {
        let escenariosAprobados = 0;
        let escenariosNoAprobados = 0;
    let filas = document.getElementById("tablaSimulacion").rows;
    for (let i = 1; i < filas.length; i++) {
        let flujos = [
            parseFloat(filas[i].cells[1].innerHTML),
            parseFloat(filas[i].cells[2].innerHTML),
            parseFloat(filas[i].cells[3].innerHTML),
            parseFloat(filas[i].cells[4].innerHTML),
            parseFloat(filas[i].cells[5].innerHTML),
        ];
        let tirCalculada = calcularTIRconFET(flujos);
        filas[i].cells[7].innerHTML = tirCalculada.toFixed(2); // Display TIR with two decimal places
        let aprobado = tirCalculada >= 30 ? "APROBADO" : "NO";
        filas[i].cells[8].innerHTML = aprobado;
        // Contar escenarios aprobados y no aprobados
        if (aprobado === "APROBADO") {
                escenariosAprobados++;
            } else {
                escenariosNoAprobados++;
            }
        // Actualizar mensaje de factibilidad
        let mensajeFactibilidad = document.getElementById("mensaje-factibilidad");
        if (escenariosAprobados > 0) {
            mensajeFactibilidad.innerHTML = "Es factible invertir en al menos un escenario.";
        } else {
            mensajeFactibilidad.innerHTML = "No es factible invertir en ninguno de los escenarios.";
        }
       // Actualizar conclusión general
       let conclusionGeneral = document.getElementById("conclusion-general");
        if (escenariosAprobados > escenariosNoAprobados) {
            conclusionGeneral.innerHTML = `En conclusión, de los ${escenariosAprobados + escenariosNoAprobados} escenarios evaluados, ${escenariosAprobados} son aprobados y ${escenariosNoAprobados} son no aprobados. En general, es factible invertir.`;
        } else {
            conclusionGeneral.innerHTML = `En conclusión, de los ${escenariosAprobados + escenariosNoAprobados} escenarios evaluados, ${escenariosAprobados} son aprobados y ${escenariosNoAprobados} son no aprobados. En general, no es factible invertir.`;
        }
    }
    }


    function calcularTIRconFET(flujos) {
        let inversionInicial = flujos[0];
        let flujosNetos = flujos.slice(1);
        let factorRecuperacion = 0;
        let acumulado = 0;

        for (let i = 0; i < flujosNetos.length; i++) {
            acumulado += flujosNetos[i];
            factorRecuperacion += acumulado / Math.pow(1 + i, 2);
        }

        return (inversionInicial / factorRecuperacion - 1) * 100;
    }
    
    function generarPDF() {
        const element = document.getElementById("contenido-pdf");

        // Esperar un breve momento para que las operaciones asíncronas se completen
        setTimeout(function () {
            const pdfOptions = {
                margin: 10,
                filename: 'simulacion_decisiones_inversion.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Agregar estilos específicos para el PDF
            const pdfStyles = `
                body {
                    background-color: #002a4c;
                }

                p {
                    color: black;
                    text-align: center;
                    font-size: 22px;
                }

                table {
                    border: 1px solid #fff;
                }

                th, td {
                    color: black;
                    background-color: #002a4c;
                    border: 1px solid #181c29;
                    text-align: left;
                    padding: 8px;
                }
            `;

            // Agregar los estilos al documento antes de generar el PDF
            const styleElement = document.createElement('style');
            styleElement.innerHTML = pdfStyles;
            document.head.appendChild(styleElement);

            // Generar el PDF
            html2pdf(element, pdfOptions);

            // Eliminar los estilos después de generar el PDF para no afectar la presentación en pantalla
            styleElement.parentNode.removeChild(styleElement);
        }, 500);
    }
     //boton para ir atras
    function goBack() {
        history.back();
    }

    function generarExcel() {
    const data = obtenerDatosTabla(); // Obtener los datos de la tabla
    const ws = XLSX.utils.json_to_sheet(data); // Convertir los datos a una hoja de cálculo
    const wb = XLSX.utils.book_new(); // Crear un nuevo libro de trabajo
    XLSX.utils.book_append_sheet(wb, ws, "SimulacionDecisiones"); // Agregar la hoja de cálculo al libro
    XLSX.writeFile(wb, 'simulacion_decisiones_inversion.xlsx'); // Descargar el archivo Excel
}

function obtenerDatosTabla() {
    const tabla = document.getElementById("tablaSimulacion");
    const data = [];

    for (let i = 1; i < tabla.rows.length; i++) {
        const rowData = {
            "Escenario": tabla.rows[i].cells[0].textContent,
            "Inversión Inicial": tabla.rows[i].cells[1].textContent,
            "Flujo de Caja Neto del Año 1": tabla.rows[i].cells[2].textContent,
            "Flujo de Caja Neto del Año 2": tabla.rows[i].cells[3].textContent,
            "Flujo de Caja Neto del Año 3": tabla.rows[i].cells[4].textContent,
            "Flujo de Caja Neto del Año 4": tabla.rows[i].cells[5].textContent,
            "Flujo de Caja Neto del Año 5": tabla.rows[i].cells[6].textContent,
            "TIR": tabla.rows[i].cells[7].textContent,
            "APROBADO": tabla.rows[i].cells[8].textContent,
        };
        data.push(rowData);
    }

    return data;
}



</script>
</body>
</html>